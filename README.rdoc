= Ubiquitous User

Many web applications required you to log in before being able to interact with
them; which poses a real barer of entry for new users. You need users to have
accounts for many tasks, but you don't need those accounts to be any more than
an id. No username, no password, no profile.

This library is an implementation of that. You add the Usable mixin to your
ApplicationController and after that call user to get a user, or user! to get a
user that exists on the database (it'll be stored if needed).

When a user log ins what you have to do is set the user, which is just doing
user = userObject.

This library also provides an authorize method, to use as a filter for those
actions that really require a logged in user.

An important consideration is that users should be mergeable now. If you have
a user with an account, and that user comes back a month latter, he may start
to operate your site with the new ghost account and only log in latter on. At
that moment you should merge the accounts.

== Installation

This gem is provided through RubyGems.org so you need to have gem configured to
pull gems from RubyGems.org.

=== Enabling RubyGems.org (formerly known as GemCutter)

You can skip this if you have RubyGems.org enabled (which is going to be the
default in the future anyway). A properly configured environment should list
rubygems.org or gemcutter.org in the gem sources, like:

  $ gem sources
  *** CURRENT SOURCES ***

  http://rubygems.org/

If you don't have it, you can probably add it this way:

  $ gem source -a http://rubygems.org/

=== Installing ubiquitous_user manually

It's simple a matter of running:

  $ gem install ubiquitous_user

and that's it. Let me know if something breaks.

=== Installing through your Ruby on Rails 3 project

In the +Gemfile+ file of your Ruby on Rails project you'll need to add:

  gem "ubiquitous_user"

after that run

  bundle install

and watch the magic happen, all required gems will be installed. Configuring
your Rails project like that is something you'll need anyway, so this is my
recommended way.

=== Installing through your Ruby on Rails 2.3 project

In the +environment.rb+ file of your Ruby on Rails project you'll have some
commented out lines like this:

  # config.gem "bj"
  # config.gem "hpricot", :version => '0.6', :source => "http://code.whytheluckystiff.net"
  # config.gem "sqlite3-ruby", :lib => "sqlite3"
  # config.gem "aws-s3", :lib => "aws/s3"

After those you can just add

  config.gem "ubiquitous_user"

and then run

  $ rake gems:install

and you'll get this and all the gems your Rails project need installed.
Configuring your Rails project like that is something you'll need anyway, so
this is my recommended way.

== How to use it

In your application_controller.rb be sure to add the mixin to
ApplicationController, like this:

  class ApplicationController < ActionController::Base
    include Usable
    
    #...
  end

After that you can use user and user! anywhere, for example:

  @item.recommender = user!
  
  <%=h user.name %>

You can use user= and authorize in the controllers, for example:

  class SessionsController < ApplicationController
    def destroy
      self.user = nil
      # ...
    end
    
    def create
      # ...
      self.user = user
    end
    
    # ...
  end
  
  class ProfilesController < ApplicationController
    before_filter :authorize
    # ...
  end

Another interesting method is the authorize generator, which allows you to
specify the message you want to give the authorization is not granted. For
example:

  class ProfilesController < ApplicationController
    before_filter :only => [:edit, :update], &authorize("You gotta log in to do that!")
    # ...
  end

But for that you also need to add an "extend", like this:

  class ApplicationController < ActionController::Base
    include Usable
    extend UsableClass
    
    #...
  end

== The model

Ubiquitous User expects you to have a model for your users called User
(configurable) with a name field (also configurable). You could create such a
model with the following command:

  ./script/generate model User name:string

The name can be the real name, the username or anything. Ubiquitous user doesn't
make any assumptions about how you authenticate users.

== Customize

ubiquitous_user expects your user model to be named User. That's not
configurable yet. What is configurable is the two methods it calls on user. You
can do this kind of configuration in config/initializers/ubiquitous_user.rb for
example:

  UsableConfig::user_model = :Account
  UsableConfig::user_model_new = :new_account
  UsableConfig::user_model_save = :save_bypassing_non_essential_validation
  UsableConfig::user_model_name = :name_or_else

== API Documentation

Up to date api documentation should be automatically generated on
http://rdoc.info/projects/pupeno/ubiquitous_user

== Metrics

You con find the metrics for this gem automatically generated at
http://getcaliper.com/caliper/project?repo=git%3A%2F%2Fgithub.com%2Fpupeno%2Fubiquitous_user.git

== Note on Patches/Pull Requests
 
* Fork the project.
* Make your feature addition or bug fix.
* Add tests for it. This is important so I don't break it in a
  future version unintentionally.
* Commit, do not mess with rakefile, version, or history.
  (if you want to have your own version, that is fine but bump version in a commit by itself I can ignore when I pull)
* Send me a pull request. Bonus points for topic branches.

== Copyright

Copyright (c) 2009 J. Pablo FernÃ¡ndez. See LICENSE for details.
